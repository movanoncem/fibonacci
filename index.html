<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>Fibonacci | TFE Morgane Van Oncem</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<link rel="icon" type="image/png" href="../_images/favicon.png" />

	
  	<link rel="stylesheet" type="text/css" href="_style/style.css">
  	<script type="text/javascript" src="http://maps.google.com/maps/api/js"></script>
  	<script type="text/javascript" src="_assets/jquery-1.10.2.min.js"></script>
 
</head>

<body onload="initialize()">
	<div class="container">
		<div class="Tom">
			<svg class="logo" version="1.1" id="frontTom" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="354.833px" height="354.833px" viewBox="0 0 354.833 354.833" xml:space="preserve">
				<g>
					<path fill="#6B6BDD" d="M261.659,78.808H93.174c-48.98,0-88.702,39.7-88.702,88.702v95.522c0,48.98,39.722,88.702,88.702,88.702 h94.235h74.25h88.702v-88.702V222.7v-55.19C350.361,118.507,310.639,78.808,261.659,78.808z"/>
					<path fill="#FFFFFF" d="M142.087,211.906c0,11.449-9.281,20.708-20.685,20.708l0,0c-11.426,0-20.685-9.259-20.685-20.708v-52.458 c0-11.404,9.259-20.662,20.685-20.662l0,0c11.404,0,20.685,9.258,20.685,20.662V211.906z"/>
					<path fill="#FFFFFF" d="M254.093,211.906c0,11.449-9.258,20.708-20.708,20.708l0,0c-11.403,0-20.685-9.259-20.685-20.708v-52.458 c0-11.404,9.282-20.662,20.685-20.662l0,0c11.449,0,20.708,9.258,20.708,20.662V211.906z"/>
				</g>
			</svg>
			<div class="hello">Vote lieu est cool !</div>
		</div>
		

		<div class="containerTexts">
			<div class="Texts">
				<H1>Fibonacci</H1>
				<p>Glissez le curseur sur la carte, ou entrez une adresse ;  Tom (ci-dessus) vous dira ensuite si le lieu que vous sélectionnez est "cool" ou "nul". Pour en savoir plus, vous pouvez lire <a href="../recherche/index.html">la page de recherche</a>.</p>
				<p style="font-size: 12px">"Cool" = Fait partie de la suite de Fibonacci</p>
				<p style="font-size: 12px; margin-top: -15px;">"Nul" =  Ne fait pas partie de la suite de Fibonacci</p>
				
			</div>
			<div class='Form'>
				<form>
		  			<input type="text" id="adresse" placeholder="Entrez une ville, une adresse"/>
		  			<input type="button"  id="submit" value="Localiser" onclick="TrouverAdresse();"/>
				</form>
				<p style="margin-top: -15px; color: #6B6BDD;">Coordonées du lieu sélectionné</p>
				<div id="mapResults"></div>
			</div>
		</div>
		<div id="map_canvas"></div>



	</div>


		
	<script type="text/javascript">

	//Create a tab with fibonacci suite 
	tab = new Array(0,1);
	for(var i=2; i<=16; i++){
		tab[i]=tab[i-1]+tab[i-2];
	}

	//Variables declarations
	var bad_place = false;
	var nice_place = false;
	var map;
	var marker;

	//Initialize the map
	google.maps.event.addDomListener(window, 'load', initialize);
	function initialize(){

		var longitude;
		var latitude;

		//Creates the map with Namur at the center 
		map = new google.maps.Map(document.getElementById('map_canvas'), {
		    center: {lat: 50.46456389999999, lng: 4.875865500000032},
		    zoom: 4
		  });

		map.setOptions({styles: newStyle});

		//Creates the marker
		var image = '_images/pin.png';
		marker = new google.maps.Marker({
		    map:map,
		    draggable:true,
		    animation: google.maps.Animation.DROP,
		    position: map.getCenter(), 
		    icon: image
		});

		//Event listener when draging the marker
		google.maps.event.addListener(marker, 'dragend', function(){
		    geocodePosition(marker.getPosition());
		});


		//Geolocation at the begining
		if (navigator.geolocation) {
	    	navigator.geolocation.getCurrentPosition(function(position) {
		        var pos = {
		          lat: position.coords.latitude,
		          lng: position.coords.longitude
		        };
		        longitude = pos.lng;
		        latitude = pos.lat;
		        
		        document.getElementById("mapResults").innerHTML = 'longitude = '+longitude+ '   latitude = ' + latitude;

		    map.setCenter(pos);
		    marker.setPosition(pos);
		    }, function() {
		    });
	    } 
	}

	//Get the position when the marker is dragged
	function geocodePosition(pos){
		nice_place = false;
		bad_place = false;
	   geocoder = new google.maps.Geocoder();
	   geocoder.geocode({
	        latLng: pos
	    }, 
	        function(results, status){
	            if (status == google.maps.GeocoderStatus.OK) {
            		latitude = (results[0].geometry.location.lat()).toString();
					longitude = (results[0].geometry.location.lng()).toString();
					document.getElementById("mapResults").innerHTML = 'Longitude = '+longitude+ '   </br> Latitude = ' + latitude;
					// Get longitude before 
	                var longitude_before_point = longitude.split(".")[0];

   					// Get longitude after .
					var longitude_after_point = (longitude.split(".")[1]);

					// Split longitude after point
					var longitude_after_point_1 = longitude_after_point.substring(0,3);
					var longitude_after_point_2 = longitude_after_point.substring(3,6);
					var longitude_after_point_3 = longitude_after_point.substring(6,9);
					var longitude_after_point_4 = longitude_after_point.substring(9,12);
					var longitude_after_point_5 = longitude_after_point.substring(12,15);

					//If in fibonacci = ok
					for(var s=1; s<17; s++ ){
						if((longitude_before_point == tab[s]) || (longitude_after_point_1 != '') && 
							(longitude_after_point_1 == tab[s]) || (longitude_after_point_2 != '') && 
							(longitude_after_point_2 == tab[s]) || (longitude_after_point_3 != '') && 
							(longitude_after_point_3 == tab[s]) || (longitude_after_point_4 != '') &&
							(longitude_after_point_4 == tab[s]) || (longitude_after_point_5 != '') &&
							(longitude_after_point_5 == tab[s])){
							nice_place = true;
						}else{
							bad_place = true;
						}
					};
					// Message alert 
					if(nice_place == true){
						$('.hello').css({'opacity': '1'});
						$('.hello').html("Votre lieu est cool &#128515;");
					}else if(bad_place == true){
						$('.hello').css({'opacity': '1'});
						$('.hello').html("Votre lieu est nul &#128542;");
					}



	            }else {

	            	document.getElementById("mapResults").innerHTML = 'Hey, vous êtes dans la mer, sélectionnez un lieu terrestre.';
	            }
	        }
	    );


	}


	//Entrer une adresse
		function TrouverAdresse() {

	  // Récupération de l'adresse tapée dans le formulaire
	  var adresse = document.getElementById('adresse').value;
	  var geocoder = new google.maps.Geocoder();
	  geocoder.geocode( { 'address': adresse}, function(results, status) {
	    if (status == google.maps.GeocoderStatus.OK) {
	      map.setCenter(results[0].geometry.location);
	      // Récupération des coordonnées GPS du lieu tapé dans le formulaire
	      var strposition = results[0].geometry.location+"";
	      strposition=strposition.replace('(', '');
	      strposition=strposition.replace(')', '');
	      // Affichage des coordonnées dans le <span>
	      document.getElementById('mapResults').innerHTML='Coordonnées : '+strposition;
	      marker.setPosition(results[0].geometry.location);
	     geocodePosition(marker.getPosition());
	     
	    } else {
	      alert('Adresse introuvable,  pouvez vous vérifier que les données sont correctes.');
	    }
	  });
	}



	var newStyle = [
  {
    "featureType": "road.highway",
    "stylers": [
      { "color": "#fecc9f" }
    ]
  },{
    "featureType": "landscape.man_made",
    "stylers": [
      { "color": "#f6ead8" }
    ]
  },{
    "featureType": "poi.attraction",
    "elementType": "geometry.fill",
    "stylers": [
      { "visibility": "off" }
    ]
  },{
    "featureType": "poi.business",
    "stylers": [
      { "visibility": "off" }
    ]
  },{
    "featureType": "water",
    "stylers": [
      { "color": "#aad4f3" }
    ]
  },{
    "featureType": "poi.park",
    "stylers": [
      { "color": "#BFD7BC" }
    ]
  },{
    "featureType": "road.local",
    "elementType": "geometry.stroke",
    "stylers": [
      { "color": "#fac48e" }
    ]
  },{
  }
]

	</script>
</body>
</html>














